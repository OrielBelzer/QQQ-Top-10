<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QQQ Top 10 Investment Calculator</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.1/tesseract.min.js'></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 2rem; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab:hover { background: #e9ecef; }
        
        .tab.active {
            background: white;
            color: #2a5298;
            border-bottom: 3px solid #2a5298;
        }
        
        .content { padding: 30px; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .input-box {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .input-box h2 { margin-bottom: 20px; }
        
        .input-box input {
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 25px;
            width: 250px;
            text-align: center;
            margin: 10px;
        }
        
        .radio-options {
            margin: 20px 0;
        }
        
        .radio-options label {
            margin: 0 15px;
            cursor: pointer;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-radius: 10px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #f1f3f4;
        }
        
        tr:hover { background: #f8f9ff; }
        
        .rank { font-weight: bold; color: #2a5298; text-align: center; }
        .company { font-weight: 600; }
        .symbol {
            font-family: 'Courier New', monospace;
            background: #f1f3f4;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .currency { color: #28a745; font-weight: 600; }
        .percentage { color: #6f42c1; font-weight: 600; }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }
        
        .summary-card h3 { font-size: 1rem; margin-bottom: 10px; }
        .summary-card .value { font-size: 1.8rem; font-weight: bold; }
        
        .total-box {
            background: #e8f5e8;
            border: 2px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .total-box .amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .upload-box {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .file-label {
            background: white;
            color: #667eea;
            padding: 15px 30px;
            border-radius: 25px;
            border: 2px solid #667eea;
            cursor: pointer;
            display: inline-block;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .file-label:hover {
            background: #667eea;
            color: white;
        }
        
        .manual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stock-field {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stock-field label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stock-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .toggle-btns {
            text-align: center;
            margin: 20px 0;
        }
        
        .toggle-btns button {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px 25px;
            margin: 0 10px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .toggle-btns button.active {
            background: #667eea;
            color: white;
        }
        
        .action-buy { color: #28a745; font-weight: 600; }
        .action-sell { color: #dc3545; font-weight: 600; }
        .action-hold { color: #6c757d; font-weight: 600; }
        
        .preview-img {
            max-width: 300px;
            margin: 15px auto;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: block;
        }
        
        .status {
            margin-top: 15px;
            font-weight: 600;
        }
        
        .rebalance-params {
            background: linear-gradient(135deg, #fbc2eb, #a6c1ee);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>QQQ Top 10 Investment Calculator</h1>
            <p>Based on actual Invesco QQQ Trust weightings</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-page="page1">Investment Calculator</button>
            <button class="tab" data-page="page2">Portfolio Rebalancing</button>
            <button class="tab" data-page="page3">Market Data</button>
        </div>
        
        <div class="content">
            <!-- PAGE 1: INVESTMENT CALCULATOR -->
            <div id="page1" class="page active">
                <div class="input-box">
                    <h2>Enter Investment Amount</h2>
                    <div>
                        <label>$</label>
                        <input type="number" id="amount" value="10000" min="1">
                    </div>
                    <div class="radio-options">
                        <label>
                            <input type="radio" name="mode" value="scaled" checked>
                            Use 100% of investment
                        </label>
                        <label>
                            <input type="radio" name="mode" value="actual">
                            Use actual QQQ weights (53.41%)
                        </label>
                    </div>
                    <button class="btn" id="calculateBtn">Calculate Allocations</button>
                </div>
                
                <div id="resultsTable"></div>
                
                <div class="summary">
                    <div class="summary-card">
                        <h3>Total Investment</h3>
                        <div class="value" id="totalDisplay">$10,000</div>
                    </div>
                    <div class="summary-card">
                        <h3>Number of Companies</h3>
                        <div class="value">10</div>
                    </div>
                    <div class="summary-card">
                        <h3>QQQ Top 10 Weight</h3>
                        <div class="value">53.41%</div>
                    </div>
                </div>
                
                <div class="note">
                    <strong>Note:</strong> These are the actual top 10 holdings from the QQQ ETF. 
                    Alphabet combines GOOGL (2.22%) and GOOG (0.82%). Data as of August 2025.
                </div>
            </div>
            
            <!-- PAGE 2: REBALANCING -->
            <div id="page2" class="page">
                <h2 style="text-align: center; color: #2a5298; margin-bottom: 20px;">Portfolio Rebalancing Tool</h2>
                
                <div class="toggle-btns">
                    <button class="active" id="uploadBtn">üì∏ Upload Screenshot</button>
                    <button id="manualBtn">‚úçÔ∏è Manual Entry</button>
                </div>
                
                <div id="uploadArea" class="upload-box">
                    <h3>Upload Portfolio Screenshot</h3>
                    <p>Upload a screenshot of your portfolio</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    <label for="fileInput" class="file-label">Choose Image</label>
                    <div id="uploadStatus"></div>
                    <div id="preview"></div>
                </div>
                
                <div id="manualArea" class="upload-box" style="display: none;">
                    <h3>Enter Your Current Holdings</h3>
                    <p>Enter the dollar amount for each stock</p>
                    <div class="manual-grid" id="manualGrid"></div>
                    <button class="btn" id="rebalanceCalcBtn">Calculate Rebalancing</button>
                </div>
                
                <div class="rebalance-params">
                    <h3>Rebalancing Parameters</h3>
                    
                    <div style="margin: 20px 0;">
                        <strong>Investment Type:</strong>
                        <div class="radio-options">
                            <label>
                                <input type="radio" name="investType" value="total" checked>
                                New Total Portfolio Value
                            </label>
                            <label>
                                <input type="radio" name="investType" value="additional">
                                Additional Investment
                            </label>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <label><strong>Amount: $</strong></label>
                        <input type="number" id="rebalanceAmount" value="20000" min="0" 
                               style="padding: 12px; font-size: 1.1rem; border-radius: 25px; border: none; width: 200px; text-align: center;">
                    </div>
                    
                    <div class="radio-options">
                        <label>
                            <input type="radio" name="rebalanceMode" value="scaled" checked>
                            Use 100% of investment
                        </label>
                        <label>
                            <input type="radio" name="rebalanceMode" value="actual">
                            Use actual QQQ weights
                        </label>
                    </div>
                </div>
                
                <div id="rebalanceResults"></div>
            </div>
            
            <!-- PAGE 3: MARKET DATA -->
            <div id="page3" class="page">
                <h2>QQQ Holdings Overview</h2>
                <div id="marketData"></div>
                <div class="note">
                    <strong>Market Data View:</strong> This shows the top 20 QQQ holdings. 
                    The Investment Calculator uses only the top 10 companies.
                </div>
            </div>
        </div>
    </div>

<script>
// DATA
const stocks = [
    {rank: 1, name: "NVIDIA Corporation", symbol: "NVDA", weight: 10.16},
    {rank: 2, name: "Microsoft Corporation", symbol: "MSFT", weight: 9.21},
    {rank: 3, name: "Apple Inc.", symbol: "AAPL", weight: 7.03},
    {rank: 4, name: "Broadcom Inc.", symbol: "AVGO", weight: 5.36},
    {rank: 5, name: "Amazon.com Inc.", symbol: "AMZN", weight: 5.20},
    {rank: 6, name: "Meta Platforms Inc.", symbol: "META", weight: 4.83},
    {rank: 7, name: "Netflix Inc.", symbol: "NFLX", weight: 3.23},
    {rank: 8, name: "Alphabet Inc. (Combined)", symbol: "GOOGL/GOOG", weight: 3.04},
    {rank: 9, name: "Tesla Inc.", symbol: "TSLA", weight: 2.97},
    {rank: 10, name: "Costco Wholesale Corp.", symbol: "COST", weight: 2.38}
];

const top20 = [
    ...stocks,
    {rank: 11, name: "Palantir Technologies Inc.", symbol: "PLTR", weight: 1.89},
    {rank: 12, name: "Advanced Micro Devices Inc.", symbol: "AMD", weight: 1.74},
    {rank: 13, name: "T-Mobile US Inc.", symbol: "TMUS", weight: 1.61},
    {rank: 14, name: "Cisco Systems Inc.", symbol: "CSCO", weight: 1.49},
    {rank: 15, name: "Linde PLC", symbol: "LIN", weight: 1.43},
    {rank: 16, name: "Intuit Inc.", symbol: "INTU", weight: 1.41},
    {rank: 17, name: "PepsiCo Inc.", symbol: "PEP", weight: 1.38},
    {rank: 18, name: "Booking Holdings Inc.", symbol: "BKNG", weight: 1.35},
    {rank: 19, name: "Intuitive Surgical Inc.", symbol: "ISRG", weight: 1.32},
    {rank: 20, name: "Texas Instruments Inc.", symbol: "TXN", weight: 1.28}
];

let holdings = {};

// TAB SWITCHING
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        
        this.classList.add('active');
        const pageId = this.getAttribute('data-page');
        document.getElementById(pageId).classList.add('active');
        
        if (pageId === 'page3') showMarketData();
        if (pageId === 'page2') setupManualEntry();
    });
});

// CALCULATE ALLOCATIONS
function calculateAllocations() {
    const amount = parseFloat(document.getElementById('amount').value) || 0;
    const mode = document.querySelector('input[name="mode"]:checked').value;
    
    const totalWeight = stocks.reduce((sum, s) => sum + s.weight, 0);
    const scale = mode === 'scaled' ? 100 / totalWeight : 1;
    
    let allocations = stocks.map(s => {
        const weight = s.weight * scale;
        const dollars = Math.round((weight / 100) * amount);
        return { ...s, weight, dollars };
    });
    
    // Adjust for rounding
    const target = mode === 'scaled' ? amount : Math.round((totalWeight / 100) * amount);
    let current = allocations.reduce((sum, a) => sum + a.dollars, 0);
    let i = 0;
    while (current !== target && i < 1000) {
        if (current < target) {
            allocations[i % 10].dollars++;
            current++;
        } else if (allocations[i % 10].dollars > 0) {
            allocations[i % 10].dollars--;
            current--;
        }
        i++;
    }
    
    // Display
    let html = '<table><thead><tr><th>Rank</th><th>Company</th><th>Symbol</th><th>Weight</th><th>Amount</th></tr></thead><tbody>';
    let total = 0;
    allocations.forEach(a => {
        total += a.dollars;
        html += `<tr>
            <td class="rank">${a.rank}</td>
            <td class="company">${a.name}</td>
            <td><span class="symbol">${a.symbol}</span></td>
            <td class="percentage">${a.weight.toFixed(2)}%</td>
            <td class="currency">$${a.dollars.toLocaleString()}</td>
        </tr>`;
    });
    html += '</tbody></table>';
    
    html += `<div class="total-box">
        <div><strong>Total Allocated: <span class="amount">$${total.toLocaleString()}</span></strong></div>
        <div style="margin-top: 10px; color: #666;">${mode === 'scaled' ? '‚úÖ Weights scaled to 100%' : 'üìä Using actual QQQ weights'}</div>
    </div>`;
    
    document.getElementById('resultsTable').innerHTML = html;
    document.getElementById('totalDisplay').textContent = '$' + amount.toLocaleString();
}

// MARKET DATA
function showMarketData() {
    let html = '<h3>QQQ Top 20 Holdings</h3><table><thead><tr><th>Rank</th><th>Company</th><th>Symbol</th><th>Weight</th><th>In Calculator</th></tr></thead><tbody>';
    top20.forEach((s, i) => {
        html += `<tr>
            <td class="rank">${s.rank}</td>
            <td class="company">${s.name}</td>
            <td><span class="symbol">${s.symbol}</span></td>
            <td class="percentage">${s.weight.toFixed(2)}%</td>
            <td>${i < 10 ? '‚úÖ Yes' : '‚ùå No'}</td>
        </tr>`;
    });
    html += '</tbody></table>';
    
    const top10Total = stocks.reduce((sum, s) => sum + s.weight, 0);
    const top20Total = top20.reduce((sum, s) => sum + s.weight, 0);
    
    html += `<div class="summary">
        <div class="summary-card"><h3>Top 10 Weight</h3><div class="value">${top10Total.toFixed(2)}%</div></div>
        <div class="summary-card"><h3>Top 20 Weight</h3><div class="value">${top20Total.toFixed(2)}%</div></div>
    </div>`;
    
    document.getElementById('marketData').innerHTML = html;
}

// REBALANCING SETUP
function setupManualEntry() {
    let html = '';
    stocks.forEach(s => {
        const sym = s.symbol.split('/')[0];
        html += `<div class="stock-field">
            <label>${s.symbol}</label>
            <input type="number" id="hold_${sym}" placeholder="$0.00" min="0" step="0.01">
        </div>`;
    });
    document.getElementById('manualGrid').innerHTML = html;
}

document.getElementById('uploadBtn').addEventListener('click', function() {
    document.getElementById('uploadArea').style.display = 'block';
    document.getElementById('manualArea').style.display = 'none';
    this.classList.add('active');
    document.getElementById('manualBtn').classList.remove('active');
});

document.getElementById('manualBtn').addEventListener('click', function() {
    document.getElementById('uploadArea').style.display = 'none';
    document.getElementById('manualArea').style.display = 'block';
    this.classList.add('active');
    document.getElementById('uploadBtn').classList.remove('active');
    setupManualEntry();
});

// CALCULATE REBALANCING
function calculateRebalancing() {
    holdings = {};
    stocks.forEach(s => {
        const sym = s.symbol.split('/')[0];
        const input = document.getElementById('hold_' + sym);
        if (input) {
            const val = parseFloat(input.value) || 0;
            if (val > 0) holdings[sym] = val;
        }
    });
    
    const currentTotal = Object.values(holdings).reduce((sum, v) => sum + v, 0);
    const investType = document.querySelector('input[name="investType"]:checked').value;
    const amount = parseFloat(document.getElementById('rebalanceAmount').value) || 0;
    const targetTotal = investType === 'total' ? amount : currentTotal + amount;
    
    const mode = document.querySelector('input[name="rebalanceMode"]:checked').value;
    const totalWeight = stocks.reduce((sum, s) => sum + s.weight, 0);
    const scale = mode === 'scaled' ? 100 / totalWeight : 1;
    
    let html = '<h3 style="color: #2a5298; margin-top: 30px;">Rebalancing Action Plan</h3>';
    html += '<table><thead><tr><th>Company</th><th>Symbol</th><th>Weight</th><th>Current $</th><th>Target $</th><th>Action</th></tr></thead><tbody>';
    
    let totalBuy = 0, totalSell = 0;
    
    stocks.forEach(s => {
        const sym = s.symbol.split('/')[0];
        const weight = s.weight * scale;
        const target = (weight / 100) * targetTotal;
        const current = holdings[sym] || 0;
        const action = target - current;
        
        let actionText, actionClass;
        if (Math.abs(action) < 0.5) {
            actionText = 'Hold';
            actionClass = 'action-hold';
        } else if (action > 0) {
            actionText = `Buy $${action.toFixed(2)}`;
            actionClass = 'action-buy';
            totalBuy += action;
        } else {
            actionText = `Sell $${Math.abs(action).toFixed(2)}`;
            actionClass = 'action-sell';
            totalSell += Math.abs(action);
        }
        
        html += `<tr>
            <td class="company">${s.name}</td>
            <td><span class="symbol">${s.symbol}</span></td>
            <td class="percentage">${weight.toFixed(2)}%</td>
            <td class="currency">$${current.toFixed(2)}</td>
            <td class="currency">$${target.toFixed(2)}</td>
            <td class="${actionClass}">${actionText}</td>
        </tr>`;
    });
    
    html += '</tbody></table>';
    
    html += `<div class="summary">
        <div class="summary-card"><h3>Current Value</h3><div class="value">$${currentTotal.toFixed(2)}</div></div>
        <div class="summary-card"><h3>Target Value</h3><div class="value">$${targetTotal.toFixed(2)}</div></div>
        <div class="summary-card"><h3>Total to Buy</h3><div class="value">$${totalBuy.toFixed(2)}</div></div>
        <div class="summary-card"><h3>Total to Sell</h3><div class="value">$${totalSell.toFixed(2)}</div></div>
    </div>`;
    
    html += `<div class="note">
        <strong>Strategy:</strong><br>
        ${investType === 'total' ? `üéØ Rebalancing to $${targetTotal.toFixed(2)}` : `üí∞ Adding $${amount.toFixed(2)}`}<br>
        ${mode === 'scaled' ? '‚úÖ Weights scaled to 100%' : 'üìä Using actual QQQ weights'}
    </div>`;
    
    document.getElementById('rebalanceResults').innerHTML = html;
}

// FILE UPLOAD & OCR
function handleFileUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    document.getElementById('uploadStatus').innerHTML = '<span class="status" style="color: #667eea;">‚è≥ Processing image...</span>';
    
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = document.createElement('img');
        img.src = event.target.result;
        img.className = 'preview-img';
        document.getElementById('preview').innerHTML = '';
        document.getElementById('preview').appendChild(img);
        
        // Run OCR
        Tesseract.recognize(
            event.target.result,
            'eng',
            {
                workerPath: 'https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/worker.min.js',
                corePath: 'https://cdn.jsdelivr.net/npm/tesseract.js-core@2.2.0/tesseract-core.wasm.js',
                logger: info => {
                    if (info.status === 'recognizing text') {
                        const percent = Math.round(info.progress * 100);
                        document.getElementById('uploadStatus').innerHTML = `<span class="status" style="color: #667eea;">‚è≥ Processing: ${percent}%</span>`;
                    }
                }
            }
        ).then(result => {
            parseOCRText(result.data.text);
            document.getElementById('uploadStatus').innerHTML = '<span class="status" style="color: #28a745;">‚úÖ Image processed! Review results below.</span>';
            calculateRebalancing();
        }).catch(err => {
            console.error(err);
            document.getElementById('uploadStatus').innerHTML = '<span class="status" style="color: #dc3545;">‚ùå Error processing image. Please try manual entry.</span>';
        });
    };
    reader.readAsDataURL(file);
}

// PARSE OCR TEXT
function parseOCRText(text) {
    holdings = {};
    const lines = text.split('\n');
    
    stocks.forEach(stock => {
        const symbols = stock.symbol.split('/');
        
        symbols.forEach(symbol => {
            const sym = symbol.trim();
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                if (line.indexOf(sym) !== -1) {
                    for (let j = i; j < Math.min(i + 4, lines.length); j++) {
                        const checkLine = lines[j];
                        const match = checkLine.match(/[\+\-]?\$[\d,]+\.?\d*/);
                        
                        if (match) {
                            const amount = match[0].replace(/[\+\$,]/g, '');
                            const value = Math.abs(parseFloat(amount));
                            
                            if (!isNaN(value) && value > 0) {
                                const mainSym = stock.symbol.split('/')[0];
                                holdings[mainSym] = (holdings[mainSym] || 0) + value;
                                break;
                            }
                        }
                    }
                    break;
                }
            }
        });
    });
    
    // Populate manual entry fields with detected values
    stocks.forEach(s => {
        const sym = s.symbol.split('/')[0];
        const input = document.getElementById('hold_' + sym);
        if (input && holdings[sym]) {
            input.value = holdings[sym].toFixed(2);
        }
    });
}

// EVENT LISTENERS
document.getElementById('calculateBtn').addEventListener('click', calculateAllocations);
document.getElementById('rebalanceCalcBtn').addEventListener('click', calculateRebalancing);
document.getElementById('fileInput').addEventListener('change', handleFileUpload);

// INITIALIZE
calculateAllocations();
</script>
</body>
</html>
